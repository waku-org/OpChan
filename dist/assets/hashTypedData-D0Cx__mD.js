import{B as f,s as S,r as $,n as z,t as M,I as k,u as A,v as l,y as B,z as c,o as N,p as g,A as b}from"./index-Cr5N_0pd.js";class O extends f{constructor({domain:t}){super(`Invalid domain "${S(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class _ extends f{constructor({primaryType:t,types:n}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(n))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class j extends f{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function C(e){const{domain:t,message:n,primaryType:s,types:r}=e,a=(i,d)=>{for(const D of i){const{name:x,type:p}=D,o=d[x],m=p.match($);if(m&&(typeof o=="number"||typeof o=="bigint")){const[w,y,P]=m;z(o,{signed:y==="int",size:Number.parseInt(P,10)/8})}if(p==="address"&&typeof o=="string"&&!M(o))throw new k({address:o});const u=p.match(A);if(u){const[w,y]=u;if(y&&l(o)!==Number.parseInt(y,10))throw new B({expectedSize:Number.parseInt(y,10),givenSize:l(o)})}const h=r[p];h&&(R(p),a(h,o))}};if(r.EIP712Domain&&t){if(typeof t!="object")throw new O({domain:t});a(r.EIP712Domain,t)}if(s!=="EIP712Domain")if(r[s])a(r[s],n);else throw new _({primaryType:s,types:r})}function H({domain:e}){return[typeof e?.name=="string"&&{name:"name",type:"string"},e?.version&&{name:"version",type:"string"},(typeof e?.chainId=="number"||typeof e?.chainId=="bigint")&&{name:"chainId",type:"uint256"},e?.verifyingContract&&{name:"verifyingContract",type:"address"},e?.salt&&{name:"salt",type:"bytes32"}].filter(Boolean)}function R(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new j({type:e})}function q(e){const{domain:t={},message:n,primaryType:s}=e,r={EIP712Domain:H({domain:t}),...e.types};C({domain:t,message:n,primaryType:s,types:r});const a=["0x1901"];return t&&a.push(W({domain:t,types:r})),s!=="EIP712Domain"&&a.push(I({data:n,primaryType:s,types:r})),c(N(a))}function W({domain:e,types:t}){return I({data:e,primaryType:"EIP712Domain",types:t})}function I({data:e,primaryType:t,types:n}){const s=T({data:e,primaryType:t,types:n});return c(s)}function T({data:e,primaryType:t,types:n}){const s=[{type:"bytes32"}],r=[F({primaryType:t,types:n})];for(const a of n[t]){const[i,d]=E({types:n,name:a.name,type:a.type,value:e[a.name]});s.push(i),r.push(d)}return g(s,r)}function F({primaryType:e,types:t}){const n=b(V({primaryType:e,types:t}));return c(n)}function V({primaryType:e,types:t}){let n="";const s=v({primaryType:e,types:t});s.delete(e);const r=[e,...Array.from(s).sort()];for(const a of r)n+=`${a}(${t[a].map(({name:i,type:d})=>`${d} ${i}`).join(",")})`;return n}function v({primaryType:e,types:t},n=new Set){const r=e.match(/^\w*/u)?.[0];if(n.has(r)||t[r]===void 0)return n;n.add(r);for(const a of t[r])v({primaryType:a.type,types:t},n);return n}function E({types:e,name:t,type:n,value:s}){if(e[n]!==void 0)return[{type:"bytes32"},c(T({data:s,primaryType:n,types:e}))];if(n==="bytes")return s=`0x${(s.length%2?"0":"")+s.slice(2)}`,[{type:"bytes32"},c(s)];if(n==="string")return[{type:"bytes32"},c(b(s))];if(n.lastIndexOf("]")===n.length-1){const r=n.slice(0,n.lastIndexOf("[")),a=s.map(i=>E({name:t,type:r,types:e,value:i}));return[{type:"bytes32"},c(g(a.map(([i])=>i),a.map(([,i])=>i)))]}return[{type:n},s]}export{q as h};
